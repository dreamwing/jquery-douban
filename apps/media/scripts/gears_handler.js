var gearsHandler=function(s){if(!google||!google.gears)return;s=$.extend({},$.douban.http.settings,s||{});if(s.data&&typeof s.data!="string")s.data=$.param(s.data);if(s.data&&s.type=="GET"||s.type=="DELETE"){s.url+=(s.url.match(/\?/)?"&":"?")+s.data;s.data=null}s.url=gearsHandler.proxy+encodeURIComponent(s.url);if(s.data)$.extend(s.headers,{'Content-Type':s.contentType});var success=s.success;s.success=null;var workerPool=google.gears.factory.create('beta.workerpool');workerPool.onmessage=function(a,b,message){var data=message.body;if(s.dataType=='json')data=eval("("+data+")");success(data)};var childWorkerId=workerPool.createWorkerFromUrl(gearsHandler.workerUrl);workerPool.sendMessage(s,childWorkerId)};gearsHandler.name='gears';gearsHandler.proxy='http://jquery-douban.appspot.com/proxy?url=';gearsHandler.workerUrl='http://jquery-douban.appspot.com/worker.js';
